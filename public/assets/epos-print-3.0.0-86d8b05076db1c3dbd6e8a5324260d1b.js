!function(t,e){function s(){this.message="",this.halftone=0,this.brightness=1,this.force=!1,this.FONT_A="font_a",this.FONT_B="font_b",this.FONT_C="font_c",this.FONT_SPECIAL_A="special_a",this.FONT_SPECIAL_B="special_b",this.ALIGN_LEFT="left",this.ALIGN_CENTER="center",this.ALIGN_RIGHT="right",this.COLOR_NONE="none",this.COLOR_1="color_1",this.COLOR_2="color_2",this.COLOR_3="color_3",this.COLOR_4="color_4",this.FEED_PEELING="peeling",this.FEED_CUTTING="cutting",this.FEED_CURRENT_TOF="current_tof",this.FEED_NEXT_TOF="next_tof",this.MODE_MONO="mono",this.MODE_GRAY16="gray16",this.BARCODE_UPC_A="upc_a",this.BARCODE_UPC_E="upc_e",this.BARCODE_EAN13="ean13",this.BARCODE_JAN13="jan13",this.BARCODE_EAN8="ean8",this.BARCODE_JAN8="jan8",this.BARCODE_CODE39="code39",this.BARCODE_ITF="itf",this.BARCODE_CODABAR="codabar",this.BARCODE_CODE93="code93",this.BARCODE_CODE128="code128",this.BARCODE_GS1_128="gs1_128",this.BARCODE_GS1_DATABAR_OMNIDIRECTIONAL="gs1_databar_omnidirectional",this.BARCODE_GS1_DATABAR_TRUNCATED="gs1_databar_truncated",this.BARCODE_GS1_DATABAR_LIMITED="gs1_databar_limited",this.BARCODE_GS1_DATABAR_EXPANDED="gs1_databar_expanded",this.HRI_NONE="none",this.HRI_ABOVE="above",this.HRI_BELOW="below",this.HRI_BOTH="both",this.SYMBOL_PDF417_STANDARD="pdf417_standard",this.SYMBOL_PDF417_TRUNCATED="pdf417_truncated",this.SYMBOL_QRCODE_MODEL_1="qrcode_model_1",this.SYMBOL_QRCODE_MODEL_2="qrcode_model_2",this.SYMBOL_MAXICODE_MODE_2="maxicode_mode_2",this.SYMBOL_MAXICODE_MODE_3="maxicode_mode_3",this.SYMBOL_MAXICODE_MODE_4="maxicode_mode_4",this.SYMBOL_MAXICODE_MODE_5="maxicode_mode_5",this.SYMBOL_MAXICODE_MODE_6="maxicode_mode_6",this.SYMBOL_GS1_DATABAR_STACKED="gs1_databar_stacked",this.SYMBOL_GS1_DATABAR_STACKED_OMNIDIRECTIONAL="gs1_databar_stacked_omnidirectional",this.SYMBOL_GS1_DATABAR_EXPANDED_STACKED="gs1_databar_expanded_stacked",this.SYMBOL_AZTECCODE_FULLRANGE="azteccode_fullrange",this.SYMBOL_AZTECCODE_COMPACT="azteccode_compact",this.SYMBOL_DATAMATRIX_SQUARE="datamatrix_square",this.SYMBOL_DATAMATRIX_RECTANGLE_8="datamatrix_rectangle_8",this.SYMBOL_DATAMATRIX_RECTANGLE_12="datamatrix_rectangle_12",this.SYMBOL_DATAMATRIX_RECTANGLE_16="datamatrix_rectangle_16",this.LEVEL_0="level_0",this.LEVEL_1="level_1",this.LEVEL_2="level_2",this.LEVEL_3="level_3",this.LEVEL_4="level_4",this.LEVEL_5="level_5",this.LEVEL_6="level_6",this.LEVEL_7="level_7",this.LEVEL_8="level_8",this.LEVEL_L="level_l",this.LEVEL_M="level_m",this.LEVEL_Q="level_q",this.LEVEL_H="level_h",this.LEVEL_DEFAULT="default",this.LINE_THIN="thin",this.LINE_MEDIUM="medium",this.LINE_THICK="thick",this.LINE_THIN_DOUBLE="thin_double",this.LINE_MEDIUM_DOUBLE="medium_double",this.LINE_THICK_DOUBLE="thick_double",this.DIRECTION_LEFT_TO_RIGHT="left_to_right",this.DIRECTION_BOTTOM_TO_TOP="bottom_to_top",this.DIRECTION_RIGHT_TO_LEFT="right_to_left",this.DIRECTION_TOP_TO_BOTTOM="top_to_bottom",this.CUT_NO_FEED="no_feed",this.CUT_FEED="feed",this.CUT_RESERVE="reserve",this.DRAWER_1="drawer_1",this.DRAWER_2="drawer_2",this.PULSE_100="pulse_100",this.PULSE_200="pulse_200",this.PULSE_300="pulse_300",this.PULSE_400="pulse_400",this.PULSE_500="pulse_500",this.PATTERN_NONE="none",this.PATTERN_1="pattern_1",this.PATTERN_2="pattern_2",this.PATTERN_3="pattern_3",this.PATTERN_4="pattern_4",this.PATTERN_5="pattern_5",this.PATTERN_6="pattern_6",this.PATTERN_7="pattern_7",this.PATTERN_8="pattern_8",this.PATTERN_9="pattern_9",this.PATTERN_10="pattern_10",this.PATTERN_A="pattern_a",this.PATTERN_B="pattern_b",this.PATTERN_C="pattern_c",this.PATTERN_D="pattern_d",this.PATTERN_E="pattern_e",this.PATTERN_ERROR="error",this.PATTERN_PAPER_END="paper_end",this.LAYOUT_RECEIPT="receipt",this.LAYOUT_RECEIPT_BM="receipt_bm",this.LAYOUT_LABEL="label",this.LAYOUT_LABEL_BM="label_bm",this.HALFTONE_DITHER=0,this.HALFTONE_ERROR_DIFFUSION=1,this.HALFTONE_THRESHOLD=2}function i(t){var e,s=t.length,i=new Array(s);for(e=0;s>e;e++)i[e]=("0"+t.charCodeAt(e).toString(16)).slice(-2);return i.join("")}function n(t){var e,s=t.length,i=new Array((s+2)/3<<2),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=(3-s%3)%3,o=0,a=0;for(t+="\x00\x00";s>a;)e=t.charCodeAt(a++)<<16|t.charCodeAt(a++)<<8|t.charCodeAt(a++),i[o++]=n.charAt(e>>18&63),i[o++]=n.charAt(e>>12&63),i[o++]=n.charAt(e>>6&63),i[o++]=n.charAt(63&e);for(;r--;)i[--o]="=";return i.join("")}function r(t,e,s){var i,n,r,o,a,_,h,E=String.fromCharCode,d=[[2,130,34,162,10,138,42,170],[194,66,226,98,202,74,234,106],[50,178,18,146,58,186,26,154],[242,114,210,82,250,122,218,90],[14,142,46,174,6,134,38,166],[206,78,238,110,198,70,230,102],[62,190,30,158,54,182,22,150],[254,126,222,94,246,118,214,86]],u=t.data,p=t.width,c=t.height,l=new Array((p+7>>3)*c),A=0,O=0,T=0,R=128,f=new Array;if(1==e)for(_=p;_--;)f.push(0);for(h=0;c>h;h++)for(i=0,n=0,_=0;p>_;)r=7&_,0==e&&(R=d[7&h][r]),o=255*Math.pow(((.29891*u[O++]+.58661*u[O++]+.11448*u[O++])*u[O]/255+255-u[O++])/255,1/s)|0,1==e&&(o+=f[_]+i>>4,a=o-(R>o?0:255),_>0&&(f[_-1]+=a),f[_]=7*a+n,i=5*a,n=3*a),R>o&&(A|=128>>r),_++,(7==r||_==p)&&(l[T++]=E(16==A?32:A),A=0);return l.join("")}function o(t,e){var s,i,n,r,o,a=String.fromCharCode,_=[[0,9,2,11],[13,4,15,6],[3,12,1,10],[16,7,14,5]],h=[0,7,13,19,23,27,31,35,40,44,49,52,54,55,57,59,61,62,64,66,67,69,70,70,71,72,73,74,75,76,77,78,79,80,81,82,83,83,84,85,86,86,87,88,88,89,90,90,91,91,92,93,93,94,94,95,96,96,97,98,98,99,99,100,101,101,102,102,103,103,104,104,105,105,106,106,107,107,108,108,109,109,110,110,111,111,112,112,112,113,113,114,114,115,115,116,116,117,117,118,118,119,119,120,120,120,121,121,122,122,123,123,123,124,124,125,125,125,126,126,127,127,127,128,128,129,129,130,130,130,131,131,132,132,132,133,133,134,134,135,135,135,136,136,137,137,137,138,138,139,139,139,140,140,141,141,141,142,142,143,143,143,144,144,145,145,146,146,146,147,147,148,148,148,149,149,150,150,150,151,151,152,152,152,153,153,154,154,155,155,155,156,156,157,157,158,158,159,159,160,160,161,161,161,162,162,163,163,164,164,165,165,166,166,166,167,167,168,168,169,169,170,170,171,171,172,173,173,174,175,175,176,177,178,178,179,180,180,181,182,182,183,184,184,185,186,186,187,189,191,193,195,198,200,202,255],E=t.data,d=t.width,u=t.height,p=new Array((d+1>>1)*u),c=0,l=0,A=0;for(o=0;u>o;o++)for(r=0;d>r;)s=1&r,i=h[255*Math.pow(((.29891*E[l++]+.58661*E[l++]+.11448*E[l++])*E[l]/255+255-E[l++])/255,1/e)|0],n=i/17|0,_[3&o][3&r]<i%17&&n++,c|=n<<(1-s<<2),r++,(1==s||r==d)&&(p[A++]=a(c),c=0);return p.join("")}function a(t){var e=/[<>&'"\t\n\r]/g;return e.test(t)&&(t=t.replace(e,function(t){var e="";switch(t){case"<":e="&lt;";break;case">":e="&gt;";break;case"&":e="&amp;";break;case"'":e="&apos;";break;case'"':e="&quot;";break;case"	":e="&#9;";break;case"\n":e="&#10;";break;case"\r":e="&#13;"}return e})),t}function _(t){var e=/[\\\x00-\x1f\x7f-\xff]/g;return e.test(t)&&(t=t.replace(e,function(t){return"\\"==t?"\\\\":"\\x"+("0"+t.charCodeAt(0).toString(16)).slice(-2)})),t}function h(t,e,s){if(!s.test(e))throw new Error('Parameter "'+t+'" is invalid');return" "+t+'="'+e+'"'}function E(t,e){return" "+t+'="'+!!e+'"'}function d(t,e,s,i){if(isNaN(e)||s>e||e>i)throw new Error('Parameter "'+t+'" is invalid');return" "+t+'="'+e+'"'}function u(t,e){return d(t,e,0,255)}function p(t,e){return d(t,e,0,65535)}function c(t,e){return d(t,e,-32768,32767)}function l(t,e,s,i,n){if(!s.test(e)&&(isNaN(e)||i>e||e>n))throw new Error('Parameter "'+t+'" is invalid');return" "+t+'="'+e+'"'}function A(t){this.address=t,this.enabled=!1,this.interval=3e3,this.timeout=3e5,this.status=0,this.battery=0,this.onreceive=null,this.onerror=null,this.onstatuschange=null,this.ononline=null,this.onoffline=null,this.onpoweroff=null,this.oncoverok=null,this.oncoveropen=null,this.onpaperok=null,this.onpaperend=null,this.onpapernearend=null,this.ondrawerclosed=null,this.ondraweropen=null,this.onbatterylow=null,this.onbatteryok=null,this.onbatterystatuschange=null,this.ASB_NO_RESPONSE=1,this.ASB_PRINT_SUCCESS=2,this.ASB_DRAWER_KICK=4,this.ASB_BATTERY_OFFLINE=4,this.ASB_OFF_LINE=8,this.ASB_COVER_OPEN=32,this.ASB_PAPER_FEED=64,this.ASB_WAIT_ON_LINE=256,this.ASB_PANEL_SWITCH=512,this.ASB_MECHANICAL_ERR=1024,this.ASB_AUTOCUTTER_ERR=2048,this.ASB_UNRECOVER_ERR=8192,this.ASB_AUTORECOVER_ERR=16384,this.ASB_RECEIPT_NEAR_END=131072,this.ASB_RECEIPT_END=524288,this.ASB_BUZZER=16777216,this.ASB_WAIT_REMOVE_LABEL=16777216,this.ASB_NO_LABEL=67108864,this.ASB_SPOOLER_IS_STOPPED=2147483648}function O(t,e,s,i,n){t.onreceive&&t.onreceive({success:e,code:s,status:i,battery:n})}function T(t,e,s){var i,n;(0==e||e==t.ASB_NO_RESPONSE)&&(e=t.status|t.ASB_NO_RESPONSE),i=0==t.status?-1:t.status^e,n=0==t.status?-1:t.battery^s,t.status=e,t.battery=s,i&&t.onstatuschange&&t.onstatuschange(e),n&&t.onbatterystatuschange&&t.onbatterystatuschange(s),i&(t.ASB_NO_RESPONSE|t.ASB_OFF_LINE)&&(e&t.ASB_NO_RESPONSE?t.onpoweroff&&t.onpoweroff():e&t.ASB_OFF_LINE?t.onoffline&&t.onoffline():t.ononline&&t.ononline()),i&t.ASB_COVER_OPEN&&(e&t.ASB_NO_RESPONSE||(e&t.ASB_COVER_OPEN?t.oncoveropen&&t.oncoveropen():t.oncoverok&&t.oncoverok())),i&(t.ASB_RECEIPT_END|t.ASB_RECEIPT_NEAR_END)&&(e&t.ASB_NO_RESPONSE||(e&t.ASB_RECEIPT_END?t.onpaperend&&t.onpaperend():e&t.ASB_RECEIPT_NEAR_END?t.onpapernearend&&t.onpapernearend():t.onpaperok&&t.onpaperok())),i&t.ASB_DRAWER_KICK&&(e&t.ASB_NO_RESPONSE||(e&t.ASB_DRAWER_KICK?(t.ondrawerclosed&&t.ondrawerclosed(),t.onbatterylow&&t.onbatterylow()):(t.ondraweropen&&t.ondraweropen(),t.onbatteryok&&t.onbatteryok())))}function R(t,e,s){t.onerror&&t.onerror({status:e,responseText:s})}function f(t){var e=t.interval;t.enabled&&((isNaN(e)||1e3>e)&&(e=3e3),t.intervalid=setTimeout(function(){delete t.intervalid,t.enabled&&t.send()},e)),delete t.intervalxhr}function g(t){this.address=t,this.mode="mono",this.halftone=0,this.brightness=1,this.align="left",this.color="color_1",this.paper="receipt",this.feed="current_tof",this.cut=!1,this.layout=null,this.ALIGN_LEFT="left",this.ALIGN_CENTER="center",this.ALIGN_RIGHT="right",this.COLOR_NONE="none",this.COLOR_1="color_1",this.COLOR_2="color_2",this.COLOR_3="color_3",this.COLOR_4="color_4",this.FEED_PEELING="peeling",this.FEED_CUTTING="cutting",this.FEED_CURRENT_TOF="current_tof",this.FEED_NEXT_TOF="next_tof",this.HALFTONE_DITHER=0,this.HALFTONE_ERROR_DIFFUSION=1,this.HALFTONE_THRESHOLD=2,this.MODE_MONO="mono",this.MODE_GRAY16="gray16",this.PAPER_RECEIPT="receipt",this.PAPER_RECEIPT_BM="receipt_bm",this.PAPER_LABEL="label",this.PAPER_LABEL_BM="label_bm"}s.prototype.addText=function(t){return this.message+="<text>"+a(t)+"</text>",this},s.prototype.addTextLang=function(t){return this.message+='<text lang="'+t+'"/>',this},s.prototype.addTextAlign=function(t){var e="";return e+=h("align",t,N),this.message+="<text"+e+"/>",this},s.prototype.addTextRotate=function(t){var e="";return e+=E("rotate",t),this.message+="<text"+e+"/>",this},s.prototype.addTextLineSpace=function(t){var e="";return e+=u("linespc",t),this.message+="<text"+e+"/>",this},s.prototype.addTextFont=function(t){var e="";return e+=h("font",t,m),this.message+="<text"+e+"/>",this},s.prototype.addTextSmooth=function(t){var e="";return e+=E("smooth",t),this.message+="<text"+e+"/>",this},s.prototype.addTextDouble=function(t,s){var i="";return t!==e&&(i+=E("dw",t)),s!==e&&(i+=E("dh",s)),this.message+="<text"+i+"/>",this},s.prototype.addTextSize=function(t,s){var i="";return t!==e&&(i+=d("width",t,1,8)),s!==e&&(i+=d("height",s,1,8)),this.message+="<text"+i+"/>",this},s.prototype.addTextStyle=function(t,s,i,n){var r="";return t!==e&&(r+=E("reverse",t)),s!==e&&(r+=E("ul",s)),i!==e&&(r+=E("em",i)),n!==e&&(r+=h("color",n,L)),this.message+="<text"+r+"/>",this},s.prototype.addTextPosition=function(t){var e="";return e+=p("x",t),this.message+="<text"+e+"/>",this},s.prototype.addTextVPosition=function(t){var e="";return e+=p("y",t),this.message+="<text"+e+"/>",this},s.prototype.addFeedUnit=function(t){var e="";return e+=u("unit",t),this.message+="<feed"+e+"/>",this},s.prototype.addFeedLine=function(t){var e="";return e+=u("line",t),this.message+="<feed"+e+"/>",this},s.prototype.addFeed=function(){return this.message+="<feed/>",this},s.prototype.addFeedPosition=function(t){var e="";return e+=h("pos",t,S),this.message+="<feed"+e+"/>",this},s.prototype.addImage=function(t,s,i,a,_,E,d){var u,c,l="",A=this.halftone,O=this.brightness;if(p("x",s),p("y",i),l+=p("width",a),l+=p("height",_),E!==e&&(l+=h("color",E,L)),d!==e&&(l+=h("mode",d,C)),isNaN(A)||0>A||A>2)throw new Error('Property "halftone" is invalid');if(isNaN(O)||.1>O||O>10)throw new Error('Property "brightness" is invalid');return u=t.getImageData(s,i,a,_),c=d==this.MODE_GRAY16?o(u,O):r(u,A,O),this.message+="<image"+l+">"+n(c)+"</image>",this},s.prototype.addLogo=function(t,e){var s="";return s+=u("key1",t),s+=u("key2",e),this.message+="<logo"+s+"/>",this},s.prototype.addBarcode=function(t,s,i,n,r,o){var E="";return E+=h("type",s,D),i!==e&&(E+=h("hri",i,B)),n!==e&&(E+=h("font",n,m)),r!==e&&(E+=u("width",r)),o!==e&&(E+=u("height",o)),this.message+="<barcode"+E+">"+_(a(t))+"</barcode>",this},s.prototype.addSymbol=function(t,s,i,n,r,o){var E="";return E+=h("type",s,y),i!==e&&(E+=l("level",i,P,0,255)),n!==e&&(E+=u("width",n)),r!==e&&(E+=u("height",r)),o!==e&&(E+=p("size",o)),this.message+="<symbol"+E+">"+_(a(t))+"</symbol>",this},s.prototype.addHLine=function(t,s,i){var n="";return n+=p("x1",t),n+=p("x2",s),i!==e&&(n+=h("style",i,v)),this.message+="<hline"+n+"/>",this},s.prototype.addVLineBegin=function(t,s){var i="";return i+=p("x",t),s!==e&&(i+=h("style",s,v)),this.message+="<vline-begin"+i+"/>",this},s.prototype.addVLineEnd=function(t,s){var i="";return i+=p("x",t),s!==e&&(i+=h("style",s,v)),this.message+="<vline-end"+i+"/>",this},s.prototype.addPageBegin=function(){return this.message+="<page>",this},s.prototype.addPageEnd=function(){return this.message+="</page>",this},s.prototype.addPageArea=function(t,e,s,i){var n="";return n+=p("x",t),n+=p("y",e),n+=p("width",s),n+=p("height",i),this.message+="<area"+n+"/>",this},s.prototype.addPageDirection=function(t){var e="";return e+=h("dir",t,I),this.message+="<direction"+e+"/>",this},s.prototype.addPagePosition=function(t,e){var s="";return s+=p("x",t),s+=p("y",e),this.message+="<position"+s+"/>",this},s.prototype.addPageLine=function(t,s,i,n,r){var o="";return o+=p("x1",t),o+=p("y1",s),o+=p("x2",i),o+=p("y2",n),r!==e&&(o+=h("style",r,v)),this.message+="<line"+o+"/>",this},s.prototype.addPageRectangle=function(t,s,i,n,r){var o="";return o+=p("x1",t),o+=p("y1",s),o+=p("x2",i),o+=p("y2",n),r!==e&&(o+=h("style",r,v)),this.message+="<rectangle"+o+"/>",this},s.prototype.addCut=function(t){var s="";return t!==e&&(s+=h("type",t,b)),this.message+="<cut"+s+"/>",this},s.prototype.addPulse=function(t,s){var i="";return t!==e&&(i+=h("drawer",t,x)),s!==e&&(i+=h("time",s,M)),this.message+="<pulse"+i+"/>",this},s.prototype.addSound=function(t,s,i){var n="";return t!==e&&(n+=h("pattern",t,w)),s!==e&&(n+=u("repeat",s)),i!==e&&(n+=p("cycle",i)),this.message+="<sound"+n+"/>",this},s.prototype.addLayout=function(t,s,i,n,r,o,a){var _="";return _+=h("type",t,F),s!==e&&(_+=p("width",s)),i!==e&&(_+=p("height",i)),n!==e&&(_+=c("margin-top",n)),r!==e&&(_+=c("margin-bottom",r)),o!==e&&(_+=c("offset-cut",o)),a!==e&&(_+=c("offset-label",a)),this.message+="<layout"+_+"/>",this},s.prototype.addRecovery=function(){return this.message+="<recovery/>",this},s.prototype.addReset=function(){return this.message+="<reset/>",this},s.prototype.addCommand=function(t){return this.message+="<command>"+i(t)+"</command>",this},s.prototype.toString=function(){var t="";return this.force&&(t+=E("force",!0)),'<epos-print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print"'+t+">"+this.message+"</epos-print>"};var m=/^(font_[abc]|special_[ab])$/,N=/^(left|center|right)$/,L=/^(none|color_[1-4])$/,S=/^(peeling|cutting|current_tof|next_tof)$/,C=/^(mono|gray16)$/,D=/^(upc_[ae]|[ej]an13|[ej]an8|code(39|93|128)|itf|codabar|gs1_128|gs1_databar_(omnidirectional|truncated|limited|expanded))$/,B=/^(none|above|below|both)$/,y=/^(pdf417_(standard|truncated)|qrcode_model_[12]|maxicode_mode_[2-6]|gs1_databar_(stacked(_omnidirectional)?|expanded_stacked)|azteccode_(fullrange|compact)|datamatrix_(square|rectangle_(8|12|16)))$/,P=/^(level_[0-8lmqh]|default)$/,v=/^(thin|medium|thick)(_double)?$/,I=/^(left_to_right|bottom_to_top|right_to_left|top_to_bottom)$/,b=/^(no_feed|feed|reserve)$/,x=/^drawer_[12]$/,M=/^pulse_[1-5]00$/,w=/^(none|pattern_(10|[1-9a-e])|error|paper_end)$/,F=/^(receipt|label)(_bm)?$/;A.prototype.open=function(){this.enabled||(this.enabled=!0,this.status=0,this.battery=0,this.send())},A.prototype.close=function(){this.enabled=!1,this.intervalid&&(clearTimeout(this.intervalid),delete this.intervalid),this.intervalxhr&&(this.intervalxhr.abort(),delete this.intervalxhr)},A.prototype.send=function(e){var i,n,r,o,a,_,h,E,d=arguments.length,u=this,p=u.address;if(1>d?e=(new s).toString():d>1&&(p=e,e=arguments[1]),i='<?xml version="1.0" encoding="utf-8"?><s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body>'+e+"</s:Body></s:Envelope>",!t.XMLHttpRequest)throw new Error("XMLHttpRequest is not supported");n=new XMLHttpRequest,"withCredentials"in n||!t.XDomainRequest?(n.open("POST",p,!0),n.setRequestHeader("Content-Type","text/xml; charset=utf-8"),n.setRequestHeader("If-Modified-Since","Thu, 01 Jan 1970 00:00:00 GMT"),n.setRequestHeader("SOAPAction",'""'),n.onreadystatechange=function(){4==n.readyState&&(clearTimeout(r),200==n.status&&n.responseXML?(o=n.responseXML.getElementsByTagName("response"),o.length>0?(a=/^(1|true)$/.test(o[0].getAttribute("success")),_=o[0].hasAttribute("code")?o[0].getAttribute("code"):"",h=o[0].hasAttribute("status")?parseInt(o[0].getAttribute("status")):0,E=o[0].hasAttribute("battery")?parseInt(o[0].getAttribute("battery")):0,d>0?O(u,a,_,h,E):T(u,h,E)):d>0?R(u,n.status,n.responseText):T(u,u.ASB_NO_RESPONSE,0)):d>0?R(u,n.status,n.responseText):T(u,u.ASB_NO_RESPONSE,0),1>d&&f(u))},r=setTimeout(function(){n.abort()},u.timeout),n.send(i)):(n=new XDomainRequest,n.open("POST",p,!0),n.onload=function(){o=n.responseText,/response/.test(o)?(a=/success\s*=\s*"\s*(1|true)\s*"/.test(o),_=o.match(/code\s*=\s*"\s*(\S*)\s*"/)?RegExp.$1:"",h=o.match(/status\s*=\s*"\s*(\d+)\s*"/)?parseInt(RegExp.$1):0,E=o.match(/battery\s*=\s*"\s*(\d+)\s*"/)?parseInt(RegExp.$1):0,d>0?O(u,a,_,h,E):T(u,h,E)):d>0?R(u,0,n.responseText):T(u,u.ASB_NO_RESPONSE,0),1>d&&f(u)},n.onerror=function(){d>0?R(u,0,n.responseText):(T(u,u.ASB_NO_RESPONSE,0),f(u))},n.onprogress=function(){},n.ontimeout=n.onerror,n.timeout=u.timeout,n.send(i)),1>d&&(u.intervalxhr=n)},g.prototype=new A,g.prototype.constructor=g,g.prototype.print=function(t){var e=arguments.length,i=this.address,n=this.cut,r=this.mode,o=this.layout,a=this.paper,_=new s,h=1;if(!t.getContext&&(i=t,t=arguments[h++],!t.getContext))throw new Error("Canvas is not supported");e>h&&(n=arguments[h++],e>h&&(r=arguments[h++])),o&&_.addLayout(a,o.width,o.height,o.margin_top,o.margin_bottom,o.offset_cut,o.offset_label),a!=this.PAPER_RECEIPT&&(_.addFeedPosition(_.FEED_CURRENT_TOF),o&&_.addFeedPosition(_.FEED_NEXT_TOF)),_.addTextAlign(this.align),_.halftone=this.halftone,_.brightness=this.brightness,_.addImage(t.getContext("2d"),0,0,t.width,t.height,this.color,r),a!=this.PAPER_RECEIPT?(_.addFeedPosition(this.feed),n&&_.addCut(_.CUT_NO_FEED)):n&&_.addCut(_.CUT_FEED),this.send(i,_.toString())},g.prototype.recover=function(){var t=new s;t.force=!0,t.addRecovery(),this.send(this.address,t.toString())},g.prototype.reset=function(){var t=new s;t.addReset(),this.send(this.address,t.toString())},t.epson||(t.epson={}),t.epson.ePOSBuilder=s,t.epson.ePOSPrint=A,t.epson.CanvasPrint=g}(window);